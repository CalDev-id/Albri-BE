import{r as L,U as F,j as t,a as v}from"./app-Bk7GbItg.js";import{u as g,w as R}from"./xlsx-DjuO7_Ju.js";import{S as k}from"./sweetalert2.esm.all-5zhdP7Ax.js";import"./flowbite.min-Dyi2Wf9s.js";import{F as Y,a as G}from"./index-BjttbWer.js";import{d as T}from"./index-kt3Yd56z.js";const V=({laporanMitra:l,bulan:j,tahun:y,nextMonth:C,nextYear:B,prevMonth:I,prevYear:E,paketMitra:x})=>{const[c,h]=L.useState([]),[u,b]=L.useState(!1),w=(e,s)=>{T.Inertia.get(route("admin.rekap.mitra"),{bulan:e,tahun:s})},i=e=>((l==null?void 0:l.data)||[]).reduce((s,d)=>s+(d[e]||0),0),P=e=>((l==null?void 0:l.data)||[]).reduce((s,d)=>{var m,n;const o=(m=d.pakets)==null?void 0:m.find(a=>a.id===e),r=((n=o==null?void 0:o.pivot)==null?void 0:n.jumlah)||0;return s+parseInt(r)},0),_=(e,s)=>{const d=(e==null?void 0:e.data)||[];if(d.length===0){alert("Tidak ada data untuk di-download");return}const r=[["No","Hari","Tanggal",...x.map(a=>a.nama_paket),"Daftar","Modul","Kaos","Kas","Lain-lain","Total Pemasukan"],...d.map((a,p)=>[p+1,a.hari,a.tanggal,...x.map(K=>{var N,S;const f=(N=a.pakets)==null?void 0:N.find(D=>D.id===K.id);return parseInt(((S=f==null?void 0:f.pivot)==null?void 0:S.jumlah)||0)}),a.daftar||0,a.modul||0,a.kaos||0,a.kas||0,a.lainlain||0,a.totalpemasukan||0])],m=g.aoa_to_sheet(r),n=g.book_new();g.book_append_sheet(n,m,"Laporan"),R(n,`${s}.xlsx`)},$=e=>{h(s=>s.includes(e)?s.filter(d=>d!==e):[...s,e])},A=()=>{h(u?[]:l.data.map(e=>e.id)),b(!u)},H=()=>{if(c.length===0){k.fire({icon:"warning",title:"Pilih Data",text:"Pilih item yang ingin dihapus terlebih dahulu",confirmButtonColor:"#3085d6"});return}k.fire({title:"Konfirmasi Hapus",text:`Yakin ingin menghapus ${c.length} item yang dipilih?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, Hapus!",cancelButtonText:"Batal"}).then(e=>{if(e.isConfirmed){const s=c.length;T.Inertia.post("/admin/laporan/mitra/bulk-delete",{ids:c},{preserveScroll:!0,onStart:()=>{h([]),b(!1)},onSuccess:()=>{k.fire({icon:"success",title:"Berhasil!",text:`${s} item berhasil dihapus`,confirmButtonColor:"#3085d6",timer:2e3,timerProgressBar:!0})},onError:()=>{k.fire({icon:"error",title:"Gagal!",text:"Terjadi kesalahan saat menghapus data",confirmButtonColor:"#3085d6"})}})}})};return F.useEffect(()=>{b(c.length===l.data.length&&l.data.length>0)},[c,l.data]),t.jsx("div",{children:t.jsxs("div",{className:"col-span-12 rounded-sm border border-stroke bg-white py-6 shadow-default dark:border-strokedark dark:bg-boxdark",children:[t.jsxs("div",{className:"flex justify-between px-7.5 mb-6",children:[t.jsxs("h4",{className:"text-xl font-semibold text-black dark:text-white",children:["Rekap Pemasukan Mitra - ",j,"/",y]}),t.jsxs("div",{children:[t.jsx("button",{onClick:()=>_(l,`${j} / ${y}`),className:"bg-green-500 text-white px-4 py-2 rounded ml-2 hover:bg-green-600",children:"Download Excel"}),c.length>0&&t.jsxs("button",{onClick:H,className:"bg-red-500 text-white px-4 py-2 rounded ml-2 hover:bg-red-600",children:["Hapus Terpilih (",c.length,")"]})]})]}),t.jsxs("div",{className:"overflow-x-auto",children:[t.jsxs("table",{className:"w-full table-auto",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-gray-2 dark:bg-meta-4",children:[t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:t.jsx("input",{type:"checkbox",checked:u,onChange:A,className:"rounded border-gray-300"})}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white pl-10",children:"Hari"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Tanggal"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white pl-10",children:"Nama"}),x&&x.length>0&&x.map((e,s)=>t.jsxs("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:[e.nama_paket," (",e.harga.toLocaleString(),")"]},s)),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Total Biaya"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Daftar"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Modul"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Kaos"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Kas"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Lain Lain"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Total"}),t.jsx("th",{className:"py-4 px-4 text-center text-sm font-medium text-black dark:text-white",children:"Aksi"})]})}),t.jsx("tbody",{children:((l==null?void 0:l.data)||[]).map((e,s)=>t.jsxs("tr",{className:"border-b border-stroke dark:border-strokedark",children:[t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:t.jsx("input",{type:"checkbox",checked:c.includes(e.id),onChange:()=>$(e.id),className:"rounded border-gray-300"})}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white pl-10",children:e.hari}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.tanggal}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white pl-10",children:e.user?e.user.name:"N/A"}),x&&x.length>0&&x.map((d,o)=>{var n,a;const r=(n=e.pakets)==null?void 0:n.find(p=>p.id===d.id),m=((a=r==null?void 0:r.pivot)==null?void 0:a.jumlah)||0;return t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:parseInt(m).toLocaleString()},o)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.totalbiaya?e.totalbiaya.toLocaleString():0}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.daftar.toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.modul.toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.kaos.toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.kas.toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.lainlain.toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.totalpemasukan.toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-center",children:t.jsxs("div",{className:"flex justify-center gap-3",children:[t.jsx(v,{href:`/admin/laporan/mitra/${e.id}/edit`,children:t.jsx(Y,{className:"text-yellow-500 hover:text-yellow-700 cursor-pointer"})}),t.jsx(v,{href:`/admin/laporan/mitra/${e.id}`,method:"delete",as:"button",data:{id:e.id},onClick:d=>{confirm("Are you sure you want to delete this user?")||d.preventDefault()},children:t.jsx(G,{className:"text-red-500 hover:text-red-700 cursor-pointer"})})]})})]},s))}),t.jsx("tfoot",{children:t.jsxs("tr",{className:"bg-gray-2 dark:bg-meta-4 font-semibold",children:[t.jsx("td",{colSpan:"4",className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white pl-10",children:"Total"}),x&&x.length>0&&x.map((e,s)=>t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:P(e.id).toLocaleString()},s)),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:i("totalbiaya").toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:i("daftar").toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:i("modul").toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:i("kaos").toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:i("kas").toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:i("lainlain").toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:i("totalpemasukan").toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-center text-sm font-medium text-black dark:text-white"})]})})]}),t.jsxs("div",{className:"flex justify-center gap-3 mt-4",children:[t.jsx("button",{onClick:()=>w(I,E),className:"py-2 px-4 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",children:"Sebelumnya"}),t.jsx("button",{onClick:()=>w(C,B),className:"py-2 px-4 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",children:"Selanjutnya"})]})]})]})})};export{V as default};
