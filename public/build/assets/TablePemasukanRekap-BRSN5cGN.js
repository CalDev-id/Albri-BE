import{r as L,U as J,j as t,a as P}from"./app-DPBPjsud.js";import{u as b,w as U}from"./xlsx-DjuO7_Ju.js";import{S as h}from"./sweetalert2.esm.all-5zhdP7Ax.js";import"./flowbite.min-Dyi2Wf9s.js";import{F as q,a as z}from"./index-dX6QUltf.js";import{d as $}from"./index-CDcaZBKG.js";const tt=({laporanCabang:m,pakets:d=[],bulan:N,tahun:w,nextMonth:K,nextYear:A,prevMonth:E,prevYear:H})=>{const[r,k]=L.useState([]),[f,p]=L.useState(!1),T=(e,s)=>{$.Inertia.get(route("admin.rekap.cabang"),{bulan:e,tahun:s})},x=e=>typeof e=="number"?e:parseInt(e,10)||0,l=e=>x(e).toLocaleString(),n=e=>m.data.reduce((s,i)=>s+x(i[e]),0),g=(e,s)=>{var u;if(!e.pakets)return 0;const i=e.pakets.find(y=>y.id===s);return i?x((u=i.pivot)==null?void 0:u.jumlah):0},B=e=>m.data.reduce((s,i)=>s+g(i,e),0),D=(e,s)=>{const i=d||[],u=["Hari","Nama","Tanggal","Cabang"],y=i.map(a=>`${a.nama_paket} (${a.harga.toLocaleString()})`),F=["Total Biaya","Daftar","Modul","Kaos","Kas","Lain Lain","Total Pemasukan"],S=[...u,...y,...F],C=e.data.map(a=>{const c={Hari:a.hari,Nama:a.user?a.user.name:"N/A",Tanggal:a.tanggal,Cabang:a.cabang?a.cabang.nama:"N/A"};return i.forEach(j=>{const G=`${j.nama_paket} (${j.harga.toLocaleString()})`;c[G]=g(a,j.id)}),c["Total Biaya"]=x(a.totalbiaya),c.Daftar=x(a.daftar),c.Modul=x(a.modul),c.Kaos=x(a.kaos),c.Kas=x(a.kas),c["Lain Lain"]=x(a.lainlain),c["Total Pemasukan"]=x(a.totalpemasukan),c}),o={Hari:"Total",Nama:"",Tanggal:"",Cabang:""};i.forEach(a=>{const c=`${a.nama_paket} (${a.harga.toLocaleString()})`;o[c]=B(a.id)}),o["Total Biaya"]=n("totalbiaya"),o.Daftar=n("daftar"),o.Modul=n("modul"),o.Kaos=n("kaos"),o.Kas=n("kas"),o["Lain Lain"]=n("lainlain"),o["Total Pemasukan"]=n("totalpemasukan"),C.push(o);const _=b.json_to_sheet(C,{header:S});b.sheet_add_aoa(_,[S],{origin:"A1"});const v=b.book_new();b.book_append_sheet(v,_,"Laporan");const Y=`Rekap_Pemasukan_cabang_${s}.xlsx`;U(v,Y)},I=e=>{k(s=>s.includes(e)?s.filter(i=>i!==e):[...s,e])},M=()=>{k(f?[]:m.data.map(e=>e.id)),p(!f)},R=()=>{if(r.length===0){h.fire({icon:"warning",title:"Pilih Data",text:"Pilih item yang ingin dihapus terlebih dahulu",confirmButtonColor:"#3085d6"});return}h.fire({title:"Konfirmasi Hapus",text:`Yakin ingin menghapus ${r.length} item yang dipilih?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, Hapus!",cancelButtonText:"Batal"}).then(e=>{if(e.isConfirmed){const s=r.length;$.Inertia.post("/admin/laporan/cabang/bulk-delete",{ids:r},{preserveScroll:!0,onStart:()=>{k([]),p(!1)},onSuccess:()=>{h.fire({icon:"success",title:"Berhasil!",text:`${s} item berhasil dihapus`,confirmButtonColor:"#3085d6",timer:2e3,timerProgressBar:!0})},onError:()=>{h.fire({icon:"error",title:"Gagal!",text:"Terjadi kesalahan saat menghapus data",confirmButtonColor:"#3085d6"})}})}})};return J.useEffect(()=>{m.data.length>0&&p(r.length===m.data.length)},[r,m.data]),t.jsx("div",{children:t.jsxs("div",{className:"col-span-12 rounded-sm border border-stroke bg-white py-6 shadow-default dark:border-strokedark dark:bg-boxdark",children:[t.jsxs("div",{className:"flex justify-between px-7.5 mb-6",children:[t.jsx("div",{children:t.jsxs("h4",{className:"text-xl font-semibold text-black dark:text-white",children:["Rekap Pemasukan Cabang - ",N,"/",w]})}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>D(m,`${N}_${w}`),className:"bg-green-500 text-white px-4 py-2 rounded ml-2 hover:bg-green-600",children:"Download Excel"}),r.length>0&&t.jsxs("button",{onClick:R,className:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600",children:["Hapus Terpilih (",r.length,")"]})]})]}),t.jsxs("div",{className:"overflow-x-auto",children:[t.jsxs("table",{className:"w-full table-auto",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-gray-2 dark:bg-meta-4",children:[t.jsx("th",{className:"py-4 px-4 text-center",children:t.jsx("input",{type:"checkbox",checked:f,onChange:M,className:"checkbox checkbox-sm"})}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white pl-10",children:"Hari"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Tanggal"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white pl-10",children:"Nama"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Cabang"}),d&&d.length>0?d.map(e=>t.jsxs("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:[e.nama_paket," (",e.harga.toLocaleString(),")"]},e.id)):null,t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Total Biaya"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Daftar"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Modul"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Kaos"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Kas"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Lain Lain"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Total"}),t.jsx("th",{className:"py-4 px-4 text-center text-sm font-medium text-black dark:text-white",children:"Actions"})]})}),t.jsx("tbody",{children:m.data.map(e=>t.jsxs("tr",{className:"border-b border-stroke dark:border-strokedark",children:[t.jsx("td",{className:"py-4 px-4 text-center",children:t.jsx("input",{type:"checkbox",checked:r.includes(e.id),onChange:()=>I(e.id),className:"checkbox checkbox-sm"})}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white pl-10",children:e.hari}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.tanggal}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white pl-10",children:e.user?e.user.name:"N/A"}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.cabang?e.cabang.nama:"N/A"}),d&&d.length>0?d.map(s=>t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:g(e,s.id)},s.id)):null,t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:l(e.totalbiaya)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:l(e.daftar)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:l(e.modul)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:l(e.kaos)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:l(e.kas)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:l(e.lainlain)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:l(e.totalpemasukan)}),t.jsx("td",{className:"py-4 px-4 text-center",children:t.jsxs("div",{className:"flex justify-center gap-3",children:[t.jsx(P,{href:`/admin/laporan/cabang/${e.id}/edit`,children:t.jsx(q,{className:"text-yellow-500 hover:text-yellow-700 cursor-pointer"})}),t.jsx(P,{href:`/admin/laporan/cabang/${e.id}`,method:"delete",as:"button",data:{id:e.id},onClick:s=>{h.fire({title:"Konfirmasi Hapus",text:"Yakin hapus laporan ini?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, Hapus!",cancelButtonText:"Batal"}).then(i=>{i.isConfirmed||s.preventDefault()})},children:t.jsx(z,{className:"text-red-500 hover:text-red-700 cursor-pointer"})})]})})]},e.id))}),t.jsx("tfoot",{children:t.jsxs("tr",{className:"bg-gray-2 dark:bg-meta-4 font-semibold",children:[t.jsx("td",{className:"py-4 px-4"})," ",t.jsx("td",{colSpan:4,className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white pl-10",children:"Total"}),d&&d.length>0?d.map(e=>t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:B(e.id)},e.id)):null,t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:l(n("totalbiaya"))}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:l(n("daftar"))}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:l(n("modul"))}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:l(n("kaos"))}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:l(n("kas"))}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:l(n("lainlain"))}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:l(n("totalpemasukan"))}),t.jsx("td",{className:"py-4 px-4 text-center text-sm font-medium text-black dark:text-white"})]})})]}),t.jsxs("div",{className:"flex justify-center gap-3 mt-4",children:[t.jsx("button",{onClick:()=>T(E,H),className:"py-2 px-4 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",children:"Sebelumnya"}),t.jsx("button",{onClick:()=>T(K,A),className:"py-2 px-4 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",children:"Selanjutnya"})]})]})]})})};export{tt as default};
