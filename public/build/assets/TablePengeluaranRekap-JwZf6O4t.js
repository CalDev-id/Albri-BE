import{r as N,U as I,j as t,a as y}from"./app-DPBPjsud.js";import{u as p,w as R}from"./xlsx-DjuO7_Ju.js";import{S as n}from"./sweetalert2.esm.all-5zhdP7Ax.js";import"./flowbite.min-Dyi2Wf9s.js";import{F as _,a as E}from"./index-dX6QUltf.js";import{d as w}from"./index-CDcaZBKG.js";const P=({laporanPengeluaranCabang:r,bulan:b,tahun:u,nextMonth:g,nextYear:S,prevMonth:L,prevYear:T})=>{const[c,o]=N.useState([]),[m,h]=N.useState(!1),f=(e,i)=>{w.Inertia.get(route("admin.rekap.cabang"),{bulan:e,tahun:i})},x=e=>r.data.reduce((i,s)=>e==="gaji"?s.gurus&&s.gurus.length>0?i+s.gurus.reduce((d,k)=>d+(k.gaji||0),0):i+(s.gaji||0):i+(s[e]||0),0),B=(e,i)=>{const s=e.data.map(a=>({Hari:a.hari,Tanggal:a.tanggal,Cabang:a.cabang?a.cabang.nama:"N/A","Nama Guru":a.user?a.user.name:"N/A",Gaji:a.gaji||0,ATK:a.atk||0,Sewa:a.sewa||0,Intensif:a.intensif||0,Lisensi:a.lisensi||0,THR:a.thr||0,"Lain Lain":a.lainlain||0,Total:a.totalpengeluaran||0})),d={Hari:"Total",Tanggal:"",Cabang:"","Nama Guru":"",Gaji:s.reduce((a,l)=>a+l.Gaji,0),ATK:s.reduce((a,l)=>a+l.ATK,0),Sewa:s.reduce((a,l)=>a+l.Sewa,0),Intensif:s.reduce((a,l)=>a+l.Intensif,0),Lisensi:s.reduce((a,l)=>a+l.Lisensi,0),THR:s.reduce((a,l)=>a+l.THR,0),"Lain Lain":s.reduce((a,l)=>a+l["Lain Lain"],0),Total:s.reduce((a,l)=>a+l.Total,0)};s.push(d);const k=p.json_to_sheet(s),j=p.book_new();p.book_append_sheet(j,k,"Pengeluaran");const H=`Rekap_Pengeluaran_cabang_${i}.xlsx`;R(j,H)},C=e=>{o(i=>i.includes(e)?i.filter(s=>s!==e):[...i,e])},v=()=>{o(m?[]:r.data.map(e=>e.id)),h(!m)},A=()=>{if(c.length===0){n.fire({icon:"warning",title:"Pilih Data",text:"Pilih item yang ingin dihapus terlebih dahulu",confirmButtonColor:"#3085d6"});return}n.fire({title:"Konfirmasi Hapus",text:`Yakin ingin menghapus ${c.length} item yang dipilih?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, Hapus!",cancelButtonText:"Batal"}).then(e=>{if(e.isConfirmed){const i=c.length;w.Inertia.post("/admin/laporan/pengeluaran/bulk-delete",{ids:c},{preserveScroll:!0,onStart:()=>{o([]),h(!1)},onSuccess:()=>{n.fire({icon:"success",title:"Berhasil!",text:`${i} item berhasil dihapus`,confirmButtonColor:"#3085d6",timer:2e3,timerProgressBar:!0})},onError:()=>{n.fire({icon:"error",title:"Gagal!",text:"Terjadi kesalahan saat menghapus data",confirmButtonColor:"#3085d6"})}})}})};return I.useEffect(()=>{r.data.length>0&&h(c.length===r.data.length)},[c,r.data]),t.jsxs("div",{className:"col-span-12 rounded-sm border border-stroke bg-white py-6 shadow-default dark:border-strokedark dark:bg-boxdark mt-20",children:[t.jsxs("div",{className:"flex justify-between px-7.5 mb-6",children:[t.jsxs("h4",{className:"text-xl font-semibold text-black dark:text-white",children:["Rekap Pengeluaran Cabang - ",b," ",u]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>B(r,`${b} / ${u}`),className:"bg-green-500 text-white px-4 py-2 rounded ml-2 hover:bg-green-600",children:"Download Excel"}),c.length>0&&t.jsxs("button",{onClick:A,className:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600",children:["Hapus Terpilih (",c.length,")"]})]})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full table-auto",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-gray-2 dark:bg-meta-4",children:[t.jsx("th",{className:"py-4 px-4 text-center",children:t.jsx("input",{type:"checkbox",checked:m,onChange:v,className:"checkbox checkbox-sm"})}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white pl-10",children:"Hari"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Tanggal"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Cabang"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Pembuat"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Gaji"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"ATK"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Sewa"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Intensif"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Lisensi"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"THR"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Lain Lain"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Total"}),t.jsx("th",{className:"py-4 px-4 text-center text-sm font-medium text-black dark:text-white",children:"Actions"})]})}),t.jsx("tbody",{children:r.data.map((e,i)=>t.jsxs("tr",{className:"border-b border-stroke dark:border-strokedark",children:[t.jsx("td",{className:"py-4 px-4 text-center",children:t.jsx("input",{type:"checkbox",checked:c.includes(e.id),onChange:()=>C(e.id),className:"checkbox checkbox-sm"})}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white pl-10",children:e.hari}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.tanggal}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.cabang?e.cabang.nama:"N/A"}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.user?e.user.name:"N/A"}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.gurus&&e.gurus.length>0?e.gurus.map(s=>t.jsxs("div",{children:[s.guru_nama," - Rp ",(s.gaji||0).toLocaleString()]},s.id)):"N/A"}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:(e.atk||0).toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:(e.sewa||0).toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:(e.intensif||0).toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:(e.lisensi||0).toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:(e.thr||0).toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:(e.lainlain||0).toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:(e.totalpengeluaran||0).toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-center",children:t.jsxs("div",{className:"flex justify-center gap-3",children:[t.jsx(y,{href:`/admin/laporan/pengeluaran/${e.id}/edit`,children:t.jsx(_,{className:"text-yellow-500 hover:text-yellow-700 cursor-pointer"})}),t.jsx(y,{href:`/admin/laporan/pengeluaran/${e.id}`,method:"delete",as:"button",data:{id:e.id},onClick:s=>{n.fire({title:"Konfirmasi Hapus",text:"Yakin hapus item ini?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, Hapus!",cancelButtonText:"Batal"}).then(d=>{d.isConfirmed||s.preventDefault()})},children:t.jsx(E,{className:"text-red-500 hover:text-red-700 cursor-pointer"})})]})})]},i))}),t.jsx("tfoot",{children:t.jsxs("tr",{className:"bg-gray-2 dark:bg-meta-4 font-semibold",children:[t.jsx("td",{className:"py-4 px-4"})," ",t.jsx("td",{colSpan:"4",className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white pl-10",children:"Total"}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:x("gaji").toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:x("atk").toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:x("sewa").toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:x("intensif").toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:x("lisensi").toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:x("thr").toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:x("lainlain").toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:x("totalpengeluaran").toLocaleString()}),t.jsx("td",{className:"py-4 px-4"})]})})]})}),t.jsxs("div",{className:"flex justify-center gap-3 mt-4",children:[t.jsx("button",{onClick:()=>f(L,T),className:"py-2 px-4 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",children:"Sebelumnya"}),t.jsx("button",{onClick:()=>f(g,S),className:"py-2 px-4 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",children:"Selanjutnya"})]})]})};export{P as default};
