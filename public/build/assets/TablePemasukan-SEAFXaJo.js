import{q as M,r as P,U as O,j as t,a as p}from"./app-DkQQNQ4T.js";import{d as $}from"./index-BhwYw7oT.js";import{u as b,w as R}from"./xlsx-DjuO7_Ju.js";import{F as Y,a as q}from"./index-CNG7MX43.js";import{S as u}from"./sweetalert2.esm.all-5zhdP7Ax.js";const X=()=>{const{laporanCabang:o,laporanPengeluaranCabang:G,startOfWeek:w,endOfWeek:T,nextWeekOffset:A,prevWeekOffset:E,pakets:m}=M().props,[x,h]=P.useState([]),[f,g]=P.useState(!1),C=e=>{$.Inertia.get(route("admin.laporan.cabang"),{weekOffset:e})},i=e=>typeof e=="number"?e:parseInt(e,10)||0,l=e=>i(e).toLocaleString(),n=e=>o.data.reduce((s,d)=>s+i(d[e]),0),y=(e,s)=>{var k;if(!e.pakets)return 0;const d=e.pakets.find(j=>j.id===s);return d?i((k=d.pivot)==null?void 0:k.jumlah):0},S=e=>o.data.reduce((s,d)=>s+y(d,e),0),K=(e,s)=>{const d=["Hari","Nama","Tanggal","Cabang"],k=m.map(a=>`${a.nama_paket} (${a.harga.toLocaleString()})`),j=["Total Biaya","Daftar","Modul","Kaos","Kas","Lain Lain","Total Pemasukan"],L=[...d,...k,...j],v=e.data.map(a=>{const r={Hari:a.hari,Nama:a.user?a.user.name:"N/A",Tanggal:a.tanggal,Cabang:a.cabang?a.cabang.nama:"N/A"};return m.forEach(N=>{const F=`${N.nama_paket} (${N.harga.toLocaleString()})`;r[F]=y(a,N.id)}),r["Total Biaya"]=i(a.totalbiaya),r.Daftar=i(a.daftar),r.Modul=i(a.modul),r.Kaos=i(a.kaos),r.Kas=i(a.kas),r["Lain Lain"]=i(a.lainlain),r["Total Pemasukan"]=i(a.totalpemasukan),r}),c={Hari:"Total",Nama:"",Tanggal:"",Cabang:""};m.forEach(a=>{const r=`${a.nama_paket} (${a.harga.toLocaleString()})`;c[r]=S(a.id)}),c["Total Biaya"]=n("totalbiaya"),c.Daftar=n("daftar"),c.Modul=n("modul"),c.Kaos=n("kaos"),c.Kas=n("kas"),c["Lain Lain"]=n("lainlain"),c["Total Pemasukan"]=n("totalpemasukan"),v.push(c);const B=b.json_to_sheet(v,{header:L});b.sheet_add_aoa(B,[L],{origin:"A1"});const _=b.book_new();b.book_append_sheet(_,B,"Laporan");const W=`Laporan_Pemasukan_cabang_${s}.xlsx`;R(_,W)},D=e=>{h(s=>s.includes(e)?s.filter(d=>d!==e):[...s,e])},H=()=>{h(f?[]:o.data.map(e=>e.id)),g(!f)},I=()=>{if(x.length===0){u.fire({icon:"warning",title:"Pilih Data",text:"Pilih item yang ingin dihapus terlebih dahulu",confirmButtonColor:"#3085d6"});return}u.fire({title:"Konfirmasi Hapus",text:`Yakin ingin menghapus ${x.length} item yang dipilih?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, Hapus!",cancelButtonText:"Batal"}).then(e=>{if(e.isConfirmed){const s=x.length;$.Inertia.post("/admin/laporan/cabang/bulk-delete",{ids:x},{preserveScroll:!0,onStart:()=>{h([]),g(!1)},onSuccess:()=>{u.fire({icon:"success",title:"Berhasil!",text:`${s} item berhasil dihapus`,confirmButtonColor:"#3085d6",timer:2e3,timerProgressBar:!0})},onError:()=>{u.fire({icon:"error",title:"Gagal!",text:"Terjadi kesalahan saat menghapus data",confirmButtonColor:"#3085d6"})}})}})};return O.useEffect(()=>{o.data.length>0&&g(x.length===o.data.length)},[x,o.data]),t.jsx("div",{children:t.jsxs("div",{className:"col-span-12 rounded-sm border border-stroke bg-white py-6 shadow-default dark:border-strokedark dark:bg-boxdark",children:[t.jsxs("div",{className:"flex justify-between px-7.5 mb-6",children:[t.jsxs("h4",{className:"text-xl font-semibold text-black dark:text-white",children:["Laporan Pemasukan Cabang (",w," sampai ",T,")"]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(p,{href:"/admin/laporan/cabang/create",children:t.jsx("button",{className:"bg-primary text-white px-4 py-2 rounded hover:bg-opacity-90",children:"Tambah Laporan"})}),t.jsx("button",{onClick:()=>K(o,`${w} sampai ${T}`),className:"bg-green-500 text-white px-4 py-2 rounded ml-2 hover:bg-green-600",children:"Download Excel"}),x.length>0&&t.jsxs("button",{onClick:I,className:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600",children:["Hapus Terpilih (",x.length,")"]}),t.jsx(p,{href:"/admin/laporan/cabang/paket/",children:t.jsx("button",{className:"bg-primary text-white px-4 py-2 rounded hover:bg-opacity-90 ml-2",children:"Setting Harga"})})]})]}),t.jsxs("div",{className:"overflow-x-auto",children:[t.jsxs("table",{className:"w-full table-auto",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-gray-2 dark:bg-meta-4",children:[t.jsx("th",{className:"py-4 px-4 text-center",children:t.jsx("input",{type:"checkbox",checked:f,onChange:H,className:"checkbox checkbox-sm"})}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white pl-10",children:"Hari"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Tanggal"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white pl-10",children:"Nama"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Cabang"}),m.map(e=>t.jsxs("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:[e.nama_paket," (",e.harga.toLocaleString(),")"]},e.id)),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Total Biaya"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Daftar"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Modul"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Kaos"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Kas"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Lain Lain"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Total"}),t.jsx("th",{className:"py-4 px-4 text-center text-sm font-medium text-black dark:text-white",children:"Actions"})]})}),t.jsx("tbody",{children:o.data.map(e=>t.jsxs("tr",{className:"border-b border-stroke dark:border-strokedark",children:[t.jsx("td",{className:"py-4 px-4 text-center",children:t.jsx("input",{type:"checkbox",checked:x.includes(e.id),onChange:()=>D(e.id),className:"checkbox checkbox-sm"})}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white pl-10",children:e.hari}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.tanggal}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white pl-10",children:e.user?e.user.name:"N/A"}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.cabang?e.cabang.nama:"N/A"}),m.map(s=>t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:y(e,s.id)},s.id)),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:l(e.totalbiaya)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:l(e.daftar)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:l(e.modul)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:l(e.kaos)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:l(e.kas)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:l(e.lainlain)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:l(e.totalpemasukan)}),t.jsx("td",{className:"py-4 px-4 text-center",children:t.jsxs("div",{className:"flex justify-center gap-3",children:[t.jsx(p,{href:`/admin/laporan/cabang/${e.id}/edit`,children:t.jsx(Y,{className:"text-yellow-500 hover:text-yellow-700 cursor-pointer"})}),t.jsx(p,{href:`/admin/laporan/cabang/${e.id}`,method:"delete",as:"button",data:{id:e.id},onClick:s=>{confirm("Yakin hapus laporan ini?")||s.preventDefault()},children:t.jsx(q,{className:"text-red-500 hover:text-red-700 cursor-pointer"})})]})})]},e.id))}),t.jsx("tfoot",{children:t.jsxs("tr",{className:"bg-gray-2 dark:bg-meta-4 font-semibold",children:[t.jsx("td",{className:"py-4 px-4 text-center"}),t.jsx("td",{colSpan:4,className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white pl-10",children:"Total"}),m.map(e=>t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:S(e.id)},e.id)),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:l(n("totalbiaya"))}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:l(n("daftar"))}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:l(n("modul"))}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:l(n("kaos"))}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:l(n("kas"))}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:l(n("lainlain"))}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:l(n("totalpemasukan"))}),t.jsx("td",{className:"py-4 px-4 text-center text-sm font-medium text-black dark:text-white"})]})})]}),t.jsxs("div",{className:"flex justify-center gap-3 mt-4",children:[t.jsx("button",{onClick:()=>C(E),className:"py-2 px-4 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",children:"Sebelumnya"}),t.jsx("button",{onClick:()=>C(A),className:"py-2 px-4 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",children:"Selanjutnya"})]})]})]})})};export{X as default};
