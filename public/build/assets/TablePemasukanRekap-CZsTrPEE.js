import{r as P,U as q,j as t,a as E}from"./app-DkQQNQ4T.js";import{u as T,w as z}from"./xlsx-DjuO7_Ju.js";import{S as b}from"./sweetalert2.esm.all-5zhdP7Ax.js";import"./flowbite.min-Dyi2Wf9s.js";import{F as J,a as O}from"./index-CNG7MX43.js";import{d as K}from"./index-BhwYw7oT.js";const tt=({laporanMitra:l,bulan:S,tahun:A,nextMonth:H,nextYear:$,prevMonth:D,prevYear:I,paketMitra:n})=>{const[m,y]=P.useState([]),[p,N]=P.useState(!1),r=e=>typeof e=="number"?e:parseInt(e,10)||0,x=e=>r(e).toLocaleString(),C=(e,s)=>{K.Inertia.get(route("admin.rekap.mitra"),{bulan:e,tahun:s})},i=e=>((l==null?void 0:l.data)||[]).reduce((s,d)=>s+r(d[e]),0),v=e=>((l==null?void 0:l.data)||[]).reduce((s,d)=>{var k;if(!d||!d.pakets||!Array.isArray(d.pakets))return s;const o=d.pakets.find(c=>c&&c.id===e),u=((k=o==null?void 0:o.pivot)==null?void 0:k.jumlah)||0;return s+r(u)},0),F=(e,s)=>{const d=(e==null?void 0:e.data)||[],o=n||[];if(d.length===0){b.fire({icon:"warning",title:"Tidak ada data",text:"Tidak ada data untuk di-download",confirmButtonColor:"#3085d6"});return}const u=["No","Hari","Tanggal",...o.map(a=>(a==null?void 0:a.nama_paket)||"N/A"),"Daftar","Modul","Kaos","Kas","Lain-lain","Total Pemasukan"],k=d.map((a,U)=>{const h={No:U+1,Hari:a.hari||"",Tanggal:a.tanggal||""};return o.forEach(g=>{var B,_;if(g&&g.nama_paket){const w=(B=a.pakets)==null?void 0:B.find(L=>L&&L.id===g.id);h[g.nama_paket]=r((_=w==null?void 0:w.pivot)==null?void 0:_.jumlah)}}),h.Daftar=r(a.daftar),h.Modul=r(a.modul),h.Kaos=r(a.kaos),h.Kas=r(a.kas),h["Lain-lain"]=r(a.lainlain),h["Total Pemasukan"]=r(a.totalpemasukan),h}),c={No:"",Hari:"Total",Tanggal:""};o.forEach(a=>{a&&a.nama_paket&&(c[a.nama_paket]=v(a.id))}),c.Daftar=i("daftar"),c.Modul=i("modul"),c.Kaos=i("kaos"),c.Kas=i("kas"),c["Lain-lain"]=i("lainlain"),c["Total Pemasukan"]=i("totalpemasukan"),k.push(c);const j=T.json_to_sheet(k,{header:u}),f=T.book_new();T.book_append_sheet(f,j,"Laporan"),z(f,`${s}.xlsx`)},R=e=>{y(s=>s.includes(e)?s.filter(d=>d!==e):[...s,e])},Y=()=>{y(p?[]:l.data.map(e=>e.id)),N(!p)},G=()=>{if(m.length===0){b.fire({icon:"warning",title:"Pilih Data",text:"Pilih item yang ingin dihapus terlebih dahulu",confirmButtonColor:"#3085d6"});return}b.fire({title:"Konfirmasi Hapus",text:`Yakin ingin menghapus ${m.length} item yang dipilih?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, Hapus!",cancelButtonText:"Batal"}).then(e=>{if(e.isConfirmed){const s=m.length;K.Inertia.post("/admin/laporan/mitra/bulk-delete",{ids:m},{preserveScroll:!0,onStart:()=>{y([]),N(!1)},onSuccess:()=>{b.fire({icon:"success",title:"Berhasil!",text:`${s} item berhasil dihapus`,confirmButtonColor:"#3085d6",timer:2e3,timerProgressBar:!0})},onError:()=>{b.fire({icon:"error",title:"Gagal!",text:"Terjadi kesalahan saat menghapus data",confirmButtonColor:"#3085d6"})}})}})};return q.useEffect(()=>{var s;const e=((s=l==null?void 0:l.data)==null?void 0:s.length)||0;N(m.length===e&&e>0)},[m,l==null?void 0:l.data]),t.jsx("div",{children:t.jsxs("div",{className:"col-span-12 rounded-sm border border-stroke bg-white py-6 shadow-default dark:border-strokedark dark:bg-boxdark",children:[t.jsxs("div",{className:"flex justify-between px-7.5 mb-6",children:[t.jsxs("h4",{className:"text-xl font-semibold text-black dark:text-white",children:["Rekap Pemasukan Mitra - ",S,"/",A]}),t.jsxs("div",{children:[t.jsx("button",{onClick:()=>F(l,`${S} / ${A}`),className:"bg-green-500 text-white px-4 py-2 rounded ml-2 hover:bg-green-600",children:"Download Excel"}),m.length>0&&t.jsxs("button",{onClick:G,className:"bg-red-500 text-white px-4 py-2 rounded ml-2 hover:bg-red-600",children:["Hapus Terpilih (",m.length,")"]})]})]}),t.jsxs("div",{className:"overflow-x-auto",children:[t.jsxs("table",{className:"w-full table-auto",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-gray-2 dark:bg-meta-4",children:[t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:t.jsx("input",{type:"checkbox",checked:p,onChange:Y,className:"rounded border-gray-300"})}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white pl-10",children:"Hari"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Tanggal"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white pl-10",children:"Nama"}),n&&Array.isArray(n)&&n.length>0&&n.map((e,s)=>t.jsxs("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:[(e==null?void 0:e.nama_paket)||"N/A"," (",e!=null&&e.harga?r(e.harga).toLocaleString():"0",")"]},s)),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Total Biaya"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Daftar"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Modul"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Kaos"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Kas"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Lain Lain"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Total"}),t.jsx("th",{className:"py-4 px-4 text-center text-sm font-medium text-black dark:text-white",children:"Aksi"})]})}),t.jsx("tbody",{children:((l==null?void 0:l.data)||[]).map((e,s)=>t.jsxs("tr",{className:"border-b border-stroke dark:border-strokedark",children:[t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:t.jsx("input",{type:"checkbox",checked:m.includes(e.id),onChange:()=>R(e.id),className:"rounded border-gray-300"})}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white pl-10",children:e.hari}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.tanggal}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white pl-10",children:e.user?e.user.name:"N/A"}),n&&Array.isArray(n)&&n.length>0&&n.map((d,o)=>{var c,j;if(!d||!d.id)return t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:"0"},o);const u=(c=e.pakets)==null?void 0:c.find(f=>f&&f.id===d.id),k=((j=u==null?void 0:u.pivot)==null?void 0:j.jumlah)||0;return t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:r(k).toLocaleString()},o)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:x(e.totalbiaya)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:x(e.daftar)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:x(e.modul)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:x(e.kaos)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:x(e.kas)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:x(e.lainlain)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:x(e.totalpemasukan)}),t.jsx("td",{className:"py-4 px-4 text-center",children:t.jsxs("div",{className:"flex justify-center gap-3",children:[t.jsx(E,{href:`/admin/laporan/mitra/${e.id}/edit`,children:t.jsx(J,{className:"text-yellow-500 hover:text-yellow-700 cursor-pointer"})}),t.jsx(E,{href:`/admin/laporan/mitra/${e.id}`,method:"delete",as:"button",data:{id:e.id},onClick:d=>{confirm("Are you sure you want to delete this user?")||d.preventDefault()},children:t.jsx(O,{className:"text-red-500 hover:text-red-700 cursor-pointer"})})]})})]},s))}),t.jsx("tfoot",{children:t.jsxs("tr",{className:"bg-gray-2 dark:bg-meta-4 font-semibold",children:[t.jsx("td",{className:"py-4 px-4"}),t.jsx("td",{colSpan:"3",className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white pl-10",children:"Total"}),n&&Array.isArray(n)&&n.length>0&&n.map((e,s)=>t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:e&&e.id?x(v(e.id)):"0"},s)),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:x(i("totalbiaya"))}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:x(i("daftar"))}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:x(i("modul"))}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:x(i("kaos"))}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:x(i("kas"))}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:x(i("lainlain"))}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:x(i("totalpemasukan"))}),t.jsx("td",{className:"py-4 px-4 text-center text-sm font-medium text-black dark:text-white"})]})})]}),t.jsxs("div",{className:"flex justify-center gap-3 mt-4",children:[t.jsx("button",{onClick:()=>C(D,I),className:"py-2 px-4 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",children:"Sebelumnya"}),t.jsx("button",{onClick:()=>C(H,$),className:"py-2 px-4 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",children:"Selanjutnya"})]})]})]})})};export{tt as default};
