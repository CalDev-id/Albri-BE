import{q as F,r as w,U as R,j as t,a as T}from"./app-CGzm6PwG.js";import{u,w as Y}from"./xlsx-DjuO7_Ju.js";import{S as c}from"./sweetalert2.esm.all-5zhdP7Ax.js";import"./flowbite.min-Dyi2Wf9s.js";import{F as q,a as U}from"./index-CQReWDKr.js";import{d as S}from"./index-Cvb8QJpj.js";const W=()=>{const{laporanPengeluaranMitra:i,bulan:b,tahun:j,nextMonth:A,nextYear:C,prevMonth:v,prevYear:L}=F().props,[x,o]=w.useState([]),[h,p]=w.useState(!1),l=e=>typeof e=="number"?e:parseInt(e,10)||0,d=e=>l(e).toLocaleString(),y=(e,a)=>{S.Inertia.get(route("admin.rekap.mitra"),{bulan:e,tahun:a})},n=e=>((i==null?void 0:i.data)||[]).reduce((a,s)=>e==="gaji"?s.mitras&&Array.isArray(s.mitras)&&s.mitras.length>0?a+s.mitras.reduce((m,k)=>m+l(k.gaji),0):a+l(s.gaji):a+l(s[e]),0),B=(e,a)=>{const s=(e==null?void 0:e.data)||[];if(s.length===0){c.fire({icon:"warning",title:"Tidak ada data",text:"Tidak ada data untuk di-download",confirmButtonColor:"#3085d6"});return}const m=s.map((r,D)=>{var N;let f=0;return r.mitras&&Array.isArray(r.mitras)&&r.mitras.length>0?f=r.mitras.reduce((G,K)=>G+l(K.gaji),0):f=l(r.gaji),{No:D+1,Hari:r.hari||"",Tanggal:r.tanggal||"",Nama:((N=r.user)==null?void 0:N.name)||"N/A",Gaji:f,ATK:l(r.atk),Intensif:l(r.intensif),Lisensi:l(r.lisensi),"Lain-lain":l(r.lainlain),"Total Pengeluaran":l(r.totalpengeluaran)}}),k={No:"",Hari:"Total",Tanggal:"",Nama:"",Gaji:n("gaji"),ATK:n("atk"),Intensif:n("intensif"),Lisensi:n("lisensi"),"Lain-lain":n("lainlain"),"Total Pengeluaran":n("totalpengeluaran")};m.push(k);const H=["No","Hari","Tanggal","Nama","Gaji","ATK","Intensif","Lisensi","Lain-lain","Total Pengeluaran"],_=u.json_to_sheet(m,{header:H}),g=u.book_new();u.book_append_sheet(g,_,"Laporan Pengeluaran"),Y(g,`${a}.xlsx`)},I=e=>{o(a=>a.includes(e)?a.filter(s=>s!==e):[...a,e])},$=()=>{o(h?[]:i.data.map(e=>e.id)),p(!h)},E=()=>{if(x.length===0){c.fire({icon:"warning",title:"Pilih Data",text:"Pilih item yang ingin dihapus terlebih dahulu",confirmButtonColor:"#3085d6"});return}c.fire({title:"Konfirmasi Hapus",text:`Yakin ingin menghapus ${x.length} item yang dipilih?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, Hapus!",cancelButtonText:"Batal"}).then(e=>{if(e.isConfirmed){const a=x.length;S.Inertia.post("/admin/laporan/pengeluaranmitra/bulk-delete",{ids:x},{preserveScroll:!0,onStart:()=>{o([]),p(!1)},onSuccess:()=>{c.fire({icon:"success",title:"Berhasil!",text:`${a} item berhasil dihapus`,confirmButtonColor:"#3085d6",timer:2e3,timerProgressBar:!0})},onError:()=>{c.fire({icon:"error",title:"Gagal!",text:"Terjadi kesalahan saat menghapus data",confirmButtonColor:"#3085d6"})}})}})};return R.useEffect(()=>{var a;const e=((a=i==null?void 0:i.data)==null?void 0:a.length)||0;p(x.length===e&&e>0)},[x,i==null?void 0:i.data]),t.jsxs("div",{className:"col-span-12 rounded-sm border border-stroke bg-white py-6 shadow-default dark:border-strokedark dark:bg-boxdark mt-20",children:[t.jsxs("div",{className:"flex justify-between px-7.5 mb-6",children:[t.jsxs("h4",{className:"text-xl font-semibold text-black dark:text-white",children:["Rekap Pengeluaran Mitra - ",b,"/",j]}),t.jsxs("div",{children:[t.jsx("button",{onClick:()=>B(i,`${b} sampai ${j}`),className:"bg-green-500 text-white px-4 py-2 rounded ml-2 hover:bg-green-600",children:"Download Excel"}),x.length>0&&t.jsxs("button",{onClick:E,className:"bg-red-500 text-white px-4 py-2 rounded ml-2 hover:bg-red-600",children:["Hapus Terpilih (",x.length,")"]})]})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full table-auto",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-gray-2 dark:bg-meta-4",children:[t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:t.jsx("input",{type:"checkbox",checked:h,onChange:$,className:"rounded border-gray-300"})}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white pl-10",children:"Hari"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Tanggal"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Pembuat"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Gaji"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"ATK"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Intensif"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Lisensi"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Lain Lain"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Total"}),t.jsx("th",{className:"py-4 px-4",children:" Aksi "})]})}),t.jsx("tbody",{children:((i==null?void 0:i.data)||[]).map((e,a)=>t.jsxs("tr",{className:"border-b border-stroke dark:border-strokedark",children:[t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:t.jsx("input",{type:"checkbox",checked:x.includes(e.id),onChange:()=>I(e.id),className:"rounded border-gray-300"})}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white pl-10",children:e.hari}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.tanggal}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.user?e.user.name:"N/A"}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.mitras&&Array.isArray(e.mitras)&&e.mitras.length>0?e.mitras.map(s=>t.jsxs("div",{children:[s.mitra_nama," - Rp ",l(s.gaji).toLocaleString()]},s.id)):`Rp ${l(e.gaji).toLocaleString()}`}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:d(e.atk)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:d(e.intensif)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:d(e.lisensi)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:d(e.lainlain)}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:d(e.totalpengeluaran)}),t.jsx("td",{className:"py-4 px-4",children:t.jsxs("div",{className:"flex flex-row items-center justify-center gap-3 h-full",children:[t.jsx(T,{href:`/admin/laporan/pengeluaranmitra/${e.id}/edit`,children:t.jsx(q,{className:"text-yellow-500 hover:text-yellow-700 cursor-pointer"})}),t.jsx(T,{href:`/admin/laporan/pengeluaranmitra/${e.id}`,method:"delete",as:"button",data:{id:e.id},onClick:s=>{confirm("Are you sure you want to delete this item?")||s.preventDefault()},children:t.jsx(U,{className:"text-red-500 hover:text-red-700 cursor-pointer"})})]})})]},a))}),t.jsx("tfoot",{children:t.jsxs("tr",{className:"bg-gray-2 dark:bg-meta-4 font-semibold",children:[t.jsx("td",{colSpan:"4",className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white pl-10",children:"Total"}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:d(n("gaji"))}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:d(n("atk"))}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:d(n("intensif"))}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:d(n("lisensi"))}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:d(n("lainlain"))}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:d(n("totalpengeluaran"))}),t.jsx("td",{className:"py-4 px-4"})]})})]})}),t.jsxs("div",{className:"flex justify-center gap-3 mt-4",children:[t.jsx("button",{onClick:()=>y(v,L),className:"py-2 px-4 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",children:"Sebelumnya"}),t.jsx("button",{onClick:()=>y(A,C),className:"py-2 px-4 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",children:"Selanjutnya"})]})]})};export{W as default};
