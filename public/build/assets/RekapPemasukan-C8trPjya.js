import{r as L,U as F,j as t,a as b}from"./app-Wjmm9iDN.js";import{u as g,w as V}from"./xlsx-DjuO7_Ju.js";import{S as f}from"./sweetalert2.esm.all-5zhdP7Ax.js";import"./flowbite.min-Dyi2Wf9s.js";import{F as Y,a as G}from"./index-B5D-nlx9.js";import{d as T}from"./index-CUudBr9S.js";const W=({laporanPrivate:i,bulan:j,tahun:w,nextMonth:B,nextYear:C,prevMonth:_,prevYear:$,paketPrivate:x})=>{const[n,h]=L.useState([]),[p,y]=L.useState(!1),N=(e,d)=>{T.Inertia.get(route("admin.rekap.private"),{bulan:e,tahun:d})},r=e=>((i==null?void 0:i.data)||[]).reduce((d,l)=>d+(l[e]||0),0),K=e=>((i==null?void 0:i.data)||[]).reduce((d,l)=>{const c=l.pakets&&l.pakets[e]?parseInt(l.pakets[e]):0;return d+c},0),E=(e,d)=>{const l=((e==null?void 0:e.data)||[]).map(a=>{var k;const s={Hari:a.hari,Tanggal:a.tanggal,"Pembuat Laporan":((k=a.user)==null?void 0:k.name)||"N/A"};return x&&x.length>0&&x.forEach(m=>{const M=`${m.nama_paket} (${m.harga.toLocaleString()})`,R=a.pakets&&a.pakets[m.id]?parseInt(a.pakets[m.id]):0;s[M]=R}),s["Total Biaya"]=a.totalbiaya||0,s.Daftar=a.daftar||0,s.Modul=a.modul||0,s.Kaos=a.kaos||0,s.Kas=a.kas||0,s["Lain Lain"]=a.lainlain||0,s["Total Pemasukan"]=a.totalpemasukan||0,s}),c={Hari:"Total",Tanggal:"","Pembuat Laporan":""};x&&x.length>0&&x.forEach(a=>{const s=`${a.nama_paket} (${a.harga.toLocaleString()})`;c[s]=l.reduce((k,m)=>k+m[s],0)}),c["Total Biaya"]=l.reduce((a,s)=>a+s["Total Biaya"],0),c.Daftar=l.reduce((a,s)=>a+s.Daftar,0),c.Modul=l.reduce((a,s)=>a+s.Modul,0),c.Kaos=l.reduce((a,s)=>a+s.Kaos,0),c.Kas=l.reduce((a,s)=>a+s.Kas,0),c["Lain Lain"]=l.reduce((a,s)=>a+s["Lain Lain"],0),c["Total Pemasukan"]=l.reduce((a,s)=>a+s["Total Pemasukan"],0),l.push(c);const o=["Hari","Tanggal","Pembuat Laporan"];x&&x.length>0&&x.forEach(a=>{o.push(`${a.nama_paket} (${a.harga.toLocaleString()})`)}),o.push("Total Biaya","Daftar","Modul","Kaos","Kas","Lain Lain","Total Pemasukan");const u=g.json_to_sheet(l,{header:o});g.sheet_add_aoa(u,[o],{origin:"A1"});const S=g.book_new();g.book_append_sheet(S,u,"Rekap");const I=`Rekap_Pemasukan_private_${d}.xlsx`;V(S,I)},D=e=>{h(d=>d.includes(e)?d.filter(l=>l!==e):[...d,e])},A=()=>{h(p?[]:i.data.map(e=>e.id)),y(!p)},H=()=>{if(n.length===0){f.fire({icon:"warning",title:"Pilih Data",text:"Pilih item yang ingin dihapus terlebih dahulu",confirmButtonColor:"#3085d6"});return}f.fire({title:"Konfirmasi Hapus",text:`Yakin ingin menghapus ${n.length} item yang dipilih?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, Hapus!",cancelButtonText:"Batal"}).then(e=>{if(e.isConfirmed){const d=n.length;T.Inertia.post("/admin/laporan/private/bulk-delete",{ids:n},{preserveScroll:!0,onStart:()=>{h([]),y(!1)},onSuccess:()=>{f.fire({icon:"success",title:"Berhasil!",text:`${d} item berhasil dihapus`,confirmButtonColor:"#3085d6",timer:2e3,timerProgressBar:!0})},onError:()=>{f.fire({icon:"error",title:"Gagal!",text:"Terjadi kesalahan saat menghapus data",confirmButtonColor:"#3085d6"})}})}})};return F.useEffect(()=>{y(n.length===i.data.length&&i.data.length>0)},[n,i.data]),t.jsx("div",{children:t.jsxs("div",{className:"col-span-12 rounded-sm border border-stroke bg-white py-6 shadow-default dark:border-strokedark dark:bg-boxdark",children:[t.jsxs("div",{className:"flex justify-between px-7.5 mb-6",children:[t.jsxs("h4",{className:"text-xl font-semibold text-black dark:text-white",children:["Rekap Pemasukan Private - ",j," / ",w]}),t.jsxs("div",{children:[t.jsx("button",{onClick:()=>E(i,`${j} / ${w}`),className:"bg-green-500 text-white px-4 py-2 rounded ml-2 hover:bg-green-600",children:"Download Excel"}),t.jsx(b,{href:"/admin/laporan/private/paket/",children:t.jsx("button",{className:"bg-primary text-white px-4 py-2 rounded hover:bg-opacity-90 ml-2",children:"Setting Harga"})}),n.length>0&&t.jsxs("button",{onClick:H,className:"bg-red-500 text-white px-4 py-2 rounded ml-2 hover:bg-red-600",children:["Hapus Terpilih (",n.length,")"]})]})]}),t.jsxs("div",{className:"overflow-x-auto",children:[t.jsxs("table",{className:"w-full table-auto",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-gray-2 dark:bg-meta-4",children:[t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:t.jsx("input",{type:"checkbox",checked:p,onChange:A,className:"rounded border-gray-300"})}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white pl-10",children:"Hari"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Tanggal"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Pembuat Laporan"}),x&&x.length>0?x.map((e,d)=>t.jsxs("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:[e.nama_paket," (",e.harga.toLocaleString(),")"]},d)):t.jsxs("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:[t.jsx("span",{className:"text-yellow-500",children:"Belum ada paket - "}),t.jsx(b,{href:"/admin/laporan/private/paket/",className:"text-blue-500 underline",children:"Tambah Paket"})]}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Total Biaya"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Daftar"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Modul"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Kaos"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Kas"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Lain Lain"}),t.jsx("th",{className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white",children:"Total"}),t.jsx("th",{className:"py-4 px-4 text-center text-sm font-medium text-black dark:text-white",children:"Aksi"})]})}),t.jsx("tbody",{children:((i==null?void 0:i.data)||[]).map((e,d)=>{var l;return t.jsxs("tr",{className:"border-b border-stroke dark:border-strokedark",children:[t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:t.jsx("input",{type:"checkbox",checked:n.includes(e.id),onChange:()=>D(e.id),className:"rounded border-gray-300"})}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white pl-10",children:e.hari}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.tanggal}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:((l=e.user)==null?void 0:l.name)||"N/A"}),x&&x.length>0?x.map((c,o)=>{const u=e.pakets&&e.pakets[c.id]?parseInt(e.pakets[c.id]):0;return t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:u.toLocaleString()},o)}):t.jsx("td",{className:"py-4 px-4 text-sm text-center text-yellow-500 dark:text-yellow-400",children:"Tidak ada paket"}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.totalbiaya?e.totalbiaya.toLocaleString():0}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.daftar?e.daftar.toLocaleString():0}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.modul?e.modul.toLocaleString():0}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.kaos?e.kaos.toLocaleString():0}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.kas?e.kas.toLocaleString():0}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.lainlain?e.lainlain.toLocaleString():0}),t.jsx("td",{className:"py-4 px-4 text-sm text-black dark:text-white",children:e.totalpemasukan?e.totalpemasukan.toLocaleString():0}),t.jsx("td",{className:"py-4 px-4 text-center",children:t.jsxs("div",{className:"flex justify-center gap-3",children:[t.jsx(b,{href:`/admin/laporan/private/${e.id}/edit`,children:t.jsx(Y,{className:"text-yellow-500 hover:text-yellow-700 cursor-pointer"})}),t.jsx(b,{href:`/admin/laporan/private/${e.id}`,method:"delete",as:"button",data:{id:e.id},onClick:c=>{confirm("Are you sure you want to delete this user?")||c.preventDefault()},children:t.jsx(G,{className:"text-red-500 hover:text-red-700 cursor-pointer"})})]})})]},d)})}),t.jsx("tfoot",{children:t.jsxs("tr",{className:"bg-gray-2 dark:bg-meta-4 font-semibold",children:[t.jsx("td",{colSpan:"4",className:"py-4 px-4 text-left text-sm font-medium text-black dark:text-white pl-10",children:"Total"}),x&&x.length>0?x.map((e,d)=>t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:K(e.id).toLocaleString()},d)):t.jsx("td",{className:"py-4 px-4 text-sm text-center text-yellow-500 dark:text-yellow-400",children:"-"}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:r("totalbiaya").toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:r("daftar").toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:r("modul").toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:r("kaos").toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:r("kas").toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:r("lainlain").toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-sm font-bold text-black dark:text-white",children:r("totalpemasukan").toLocaleString()}),t.jsx("td",{className:"py-4 px-4 text-center text-sm font-medium text-black dark:text-white"})]})})]}),t.jsxs("div",{className:"flex justify-center gap-3 mt-4",children:[t.jsx("button",{onClick:()=>N(_,$),className:"py-2 px-4 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",children:"Sebelumnya"}),t.jsx("button",{onClick:()=>N(B,C),className:"py-2 px-4 bg-gray-300 text-gray-700 rounded hover:bg-gray-400",children:"Selanjutnya"})]})]})]})})};export{W as default};
